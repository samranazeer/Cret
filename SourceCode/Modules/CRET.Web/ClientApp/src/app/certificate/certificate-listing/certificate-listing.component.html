<!--container header -->

<div class="drag-drop-area" (dragover)="onDragOver($event)"
(dragleave)="onDragLeave($event)" (drop)="onDrop($event)" [ngClass]="{'highlight': isDragging}">
</div>



<div class="content-header">
  <div class="heading">
    <h1>Certificates</h1>
    <span>Manage your Certificates</span>
  </div>
  <button class="btn add-btn" type="button" (click)="addCertificate()">
    <span class="icon-add"></span> Add
  </button>

  <button
    class="btn download-btn"
    type="button"
    (click)="openImportCsrDialog()"
  >
    <span class="icon-download"></span> Import CSR / Certificate
  </button>
<!-- 
  <button
    class="btn download-btn"
    type="button"
    (click)="openImportCertificateDialog()"
  >
    <span class="icon-download"></span> Import Certificates
  </button> -->

  <button
    *ngIf="selectedRows.length > 0"
    class="btn download-btn"
    type="button"
    (click)="openBatchSendDialog()"
  >
    <span>
      <img src="assets/images/send.svg" height="16" alt="" />
    </span>
    Send Batch
  </button>
</div>

<!-- search area -->
<div class="search-holder">
  <div class="search">
    <span class="icon-search"></span>
    <input matInput
           #input
           [formControl]="searchKeywordFilter"
           type="search"
           placeholder="Search by Info..."
           (keyup.enter)="searchKeywordAction()" />
    <button type="button" class="btn-search" (click)="searchKeywordAction()">Search</button>
  </div>
  <div style="position: relative">
    <button
      style="background-color: white; width: 150px; color: #64748B; border: none; font-weight: 500;"
      class="btn download-btn"
      (click)="toggleFilterCardVisibility()"
      type="button"
    >
      <!-- <span>
        <img src="assets/images/send.svg" height="16" alt="Your SVG Image" />
      </span> -->
      <span class="icon-filter"></span>
      Filter
      <span class="{{ showCard ? 'icon-arrow-up' : 'icon-arrow-down' }}" style="vertical-align: middle; font-size: 24px;"></span>

    </button>

    <mat-card class="overlay-card" *ngIf="showCard" style="max-width: 380px">
      <form #certificateForm="ngForm" class="mt-3">
        <div class="px-3">
          <!-- Organization -->
          <div class="pb-0">
            <mat-label> Organization</mat-label>
            <mat-form-field appearance="outline" class="example-full-width">
              <mat-select
                name="organizationId"
                [(ngModel)]="filterationModel.organizationName"
                #organizationId="ngModel"
              >
                <mat-option value="All">All</mat-option>
                <mat-option
                  *ngFor="let item of organizationList"
                  [value]="item.id"
                  >{{ item.organizationName }}</mat-option
                >
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Certificate Level (Type) -->
          <div>
            <mat-label class="col-form-label">Certificate Level</mat-label>
            <mat-form-field appearance="outline" class="example-full-width">
              <mat-select
                name="level"
                [(ngModel)]="filterationModel.certificateLevel"
                #level="ngModel"
              >
                <mat-option value="All">All</mat-option>

                <mat-option
                  *ngFor="let key of certificateLevelEnum"
                  [value]="key.key"
                >
                  {{ key.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <mat-label class="col-form-label">Date</mat-label>
          <div style="display: flex; justify-content: space-between">
            <mat-form-field
              appearance="outline"
              style="max-width: 150px; margin-right: 5px">
              <input
                placeholder="From"
                matInput
                [matDatepicker]="frompicker"
                name="dateFrom"
                [(ngModel)]="filterationModel.dateFrom"
                #dateFrom="ngModel"
              />
              <mat-hint>MM/DD/YYYY</mat-hint>
              <mat-datepicker-toggle
                matSuffix
                [for]="frompicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #frompicker></mat-datepicker>
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              style="max-width: 150px; margin-left: 5px"
            >
              <input
              placeholder="To"
                matInput
                [matDatepicker]="topicker"
                name="dateTo"
                [(ngModel)]="filterationModel.dateTo"
                #dateTo="ngModel"
              />
              <mat-hint>MM/DD/YYYY</mat-hint>
              <mat-datepicker-toggle
                matSuffix
                [for]="topicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #topicker></mat-datepicker>
            </mat-form-field>
          </div>
          <!-- Certificate Status -->
          <div>
            <mat-label class="col-form-label">Certificate Status</mat-label>
            <mat-form-field appearance="outline" class="example-full-width">
              <mat-select
                name="level"
                [(ngModel)]="filterationModel.certificateStatus"
                #level="ngModel"
              >
                <mat-option value="All">All</mat-option>
                <mat-option
                  *ngFor="let key of certificateStatusEnum"
                  [value]="key.key"
                >
                  {{ key.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="py-1" style="display: flex; justify-content: end">
            <button
              class="btn add-btn add-action-btn"
              type="button"
              (click)="filterData()"
              [disabled]="certificateForm.form.invalid"
            >
              Apply
            </button>

            <button
              class="btn cancel-btn cancel-action-button"
              (click)="clearFilter()"
            >
              Clear
            </button>
          </div>
        </div>
      </form>
    </mat-card>
  </div>
</div>
<!-- table area -->
<div class="table_wrapper">
  <table mat-table  [dataSource]="dataSource"
         matSort
          [matSortDisableClear]="true"
         [matSortActive]="sort.active" 
         [matSortDirection]="sort.direction">
    <!--- Note that these columns can be defined in any order.
    The actual rendered columns are set as a property on the row definition" -->
    <!-- Checkbox Column -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>#</th>
      <th mat-header-cell *matHeaderCellDef>
      </th>
      <td mat-cell *matCellDef="let row; let i = index">

        <!-- <input [disabled]="row.certificateStatus == StatusEnum.CSR_Received" type="checkbox" name="ckb" #checkboxes (click)="masterToggle(row,i)" /> -->
        <input [style.display]="row.certificateStatus == StatusEnum.CSR_Received ? 'none' : 'block'" type="checkbox" name="ckb" #checkboxes (click)="masterToggle(row,i)" />

      </td>
    </ng-container>

    <!-- Position Column -->
    <!--<ng-container matColumnDef="incidentNo">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Incident Number</th>
    <td mat-cell *matCellDef="let element">{{ element.incidentNo }}</td>
  </ng-container>-->
    <!-- Position Column -->

    <!-- <ng-container matColumnDef="incidentNo">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Incident Number</th>
      <td mat-cell *matCellDef="let element">{{ element.incidentNo }}</td>
    </ng-container> -->

    <ng-container matColumnDef="organizationName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        Organization Name
      </th>
      <td mat-cell *matCellDef="let element">{{ element.organizationName }}</td>
    </ng-container>

    <!-- Position Column -->
    <ng-container matColumnDef="tag">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Tag</th>
      <td mat-cell *matCellDef="let element">{{ element.tag }}</td>
    </ng-container>


    <!-- Position Column -->
    <ng-container matColumnDef="level">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Level</th>
      <td mat-cell *matCellDef="let element">
        {{ element.certificateName }}
      </td>
    </ng-container>

    <!-- Position Column -->
    <ng-container matColumnDef="certificateStatus">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        Certificate Status
      </th>
      <td mat-cell *matCellDef="let element">
        <!-- <button mat-button style="background-color: #f0f0f7; color: #7372b2; padding: 0px 40px;">
        {{ StatusEnum[element.certificateStatus] }}
      </button> -->
        <button mat-button
                style="min-width: 120px"
                [style.color]="applyStatusTextColor(element.certificateStatus)"
                [style.background-color]="
            getStatusBackgroundColor(element.certificateStatus)
          ">
          {{ StatusDisplayType[element.certificateStatus] }}
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="info">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Info</th>
      <td mat-cell *matCellDef="let element">
        {{ element.info }}
      </td>
    </ng-container>

    <!-- Position Column -->
    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Modification Date</th>
      <td mat-cell *matCellDef="let element">
        {{ element.createdAt | date : "MMMM d, yyyy" }}
      </td>
    </ng-container>

    <!-- Weight Column -->
    <ng-container matColumnDef="createdBy">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Created By</th>
      <td mat-cell *matCellDef="let element">{{ element.createdBy }}</td>
    </ng-container>

    <ng-container matColumnDef="action">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let element">
        <button class="table-btn">
          <span class="icon-edit" (click)="editCertificate(element)"></span>
        </button>
        <button class="table-btn"
                (click)="deleteCertificate(element.id)"
                *ngIf="element.certificateStatus == StatusEnum.Created || isSuperAdmin" >
          <span class="icon-trash"></span>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    <!-- Row shown when there is no matching data. -->
  </table>
  <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>
  <mat-paginator
    #paginator
    [length]="totalData"
    [pageSizeOptions]="pageSizes"
    showFirstLastButtons
  ></mat-paginator>
</div>

<input #csrFileInput type="file" (change)="handleFileInput($event)" style="display: none" [accept]="fileExtension" />
